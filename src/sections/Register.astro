---

---

<form class="max-w-sm mx-auto md:min-w-96">
  <div class="mb-5">
    <div class="mb-5">
      <label for="email" class="block mb-2 text-sm font-regular text-primary"
        >Nombre de usuario</label
      >
      <input
        type="text"
        id="username"
        class="bg-secondary border border-gray-300 text-primary text-sm rounded-lg block w-full p-2.5"
        placeholder="DuendeMaaron"
        required
      />
    </div>
    <label for="email" class="block mb-2 text-sm font-regular text-primary"
      >Correo electrónico</label
    >
    <input
      type="email"
      id="email"
      class="bg-secondary border border-gray-300 text-primary text-sm rounded-lg block w-full p-2.5"
      placeholder="correo@gmail.com"
      required
    />
  </div>
  <div class="mb-5">
    <label for="password" class="block mb-2 text-sm font-regular text-primary"
      >Contraseña</label
    >
    <input
      type="password"
      id="password"
      class="bg-secondary border border-gray-300 text-primary text-sm rounded-lg block w-full p-2.5"
      placeholder="pepelotas77"
      required
    />
  </div>
  <div class="mb-4">
    <input type="checkbox" id="toggle-password" class="mr-1" />
    <label for="togglePassword" class="text-sm text-primary"
      >Mostrar contraseña</label
    >
  </div>
  <div class="flex flex-col gap-4">
    <button
      id="button-register"
      type="button"
      class="text-white bg-accent border border-gray-300 hover:bg-secondary font-regular rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center"
      >Registrarme</button
    >

    <button
      id="button-login"
      type="button"
      class="text-white bg-accent border border-gray-300 hover:bg-secondary font-regular rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center"
      >Ya tengo una cuenta</button
    >
  </div>
</form>

<script>
  document?.getElementById("button-login")?.addEventListener("click", () => {
    window.location.href = "/";
  });

  document
    ?.getElementById("toggle-password")
    ?.addEventListener("change", togglePassword);

  function togglePassword() {
    const password = document?.getElementById("password");
    const type =
      password?.getAttribute("type") === "password" ? "text" : "password";
    password?.setAttribute("type", type);
  }

  document
    ?.getElementById("button-register")
    ?.addEventListener("click", async () => {
      const email = (document?.getElementById("email") as HTMLInputElement)
        ?.value;
      const username = (
        document?.getElementById("username") as HTMLInputElement
      )?.value;
      const password = (
        document?.getElementById("password") as HTMLInputElement
      )?.value;
      const isAdmin = false;

      if (!email || !username || !password) {
        window.toast({
          title: "Todos los campos son obligatorios.",
          location: "bottom-center",
          dismissible: false,
          type: "warning",
          icon: true,
        });

        return;
      }

      try {
        const response = await fetch("/api/auth/register", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },

          body: JSON.stringify({ username, email, password, isAdmin }),
        });

        if (response.status === 201) {
          const data = await response.json();

          window.toast({
            title: `¡Bienvenido, ${data.username}!.`,
            location: "bottom-center",
            dismissible: false,
            type: "success",
            icon: true,
          });

          setTimeout(() => {
            window.location.href = "/";
          }, 2000);
        } else if (response.status === 400) {
          window.toast({
            title: "Ya existe un usuario con este correo o nombre.",
            location: "bottom-center",
            dismissible: false,
            type: "warning",
            icon: true,
          });
        } else if (response.status === 500) {
          window.toast({
            title: "Se ha producido un error inesperado.",
            location: "bottom-center",
            dismissible: false,
            type: "error",
            icon: true,
          });
        }
      } catch (error) {
        window.toast({
          title: "Se ha producido un error inesperado.",
          location: "bottom-center",
          dismissible: false,
          type: "error",
          icon: true,
        });
      }
    });
</script>
